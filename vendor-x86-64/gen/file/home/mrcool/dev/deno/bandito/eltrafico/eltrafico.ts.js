function findEltraficoTc() {
  return Deno.env.get("TC") || "eltrafico-tc";
}
export class ElTrafico {
  #tc;
  #reader;
  #writer;
  constructor(){
    this.#tc = new Deno.Command("pkexec", {
      args: [
        findEltraficoTc()
      ],
      stdout: "piped",
      stdin: "piped",
      stderr: "inherit"
    }).spawn();
    this.#reader = this.#tc.stdout.getReader();
    this.#writer = this.#tc.stdin.getWriter();
  }
  async #read() {
    return await this.#reader.read().then((data)=>// the data is small
      // it should be done in one read
      // NOTE: this assumption might not hold
      new TextDecoder().decode(data.value));
  }
  async #write(data) {
    return await this.#writer.write(new TextEncoder().encode(data + "\n"));
  }
  async limit(program) {
    const startMsg = program.global ? "Global: " : `Program: ${program.name}`;
    const limitAction = `${startMsg} ${getLimit(program.downloadLimit)} ${getLimit(program.uploadLimit)} ${getLimit(program.downloadMinimum)} ${getLimit(program.uploadMinimum)}`;
    await this.#write(limitAction);
  }
  async stop() {
    await this.#write("Stop");
  }
  async interface(name) {
    await this.#write(`Interface: ${name}`);
  }
  async poll() {
    const data = await this.#read();
    if (data == "Stop") {
      return {
        stop: true
      };
    }
    return {
      programs: data.split("\n").filter((l)=>l).map((line)=>{
        return {
          name: line.split("ProgramEntry: ")[1]
        };
      }),
      stop: false
    };
  }
}
function getLimit(limitAndUnit) {
  if (limitAndUnit) {
    return limitAndUnit.value.toString() + limitAndUnit.unit;
  } else {
    return "None";
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vaG9tZS9tcmNvb2wvZGV2L2Rlbm8vYmFuZGl0by9lbHRyYWZpY28vZWx0cmFmaWNvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVuaXQgfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy90YWJsZS50c1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFByb2dyYW0ge1xuICBuYW1lPzogc3RyaW5nO1xuICBnbG9iYWw/OiBib29sZWFuO1xuICBkb3dubG9hZExpbWl0Pzoge1xuICAgIHZhbHVlOiBudW1iZXI7XG4gICAgdW5pdDogVW5pdDtcbiAgfTtcbiAgdXBsb2FkTGltaXQ/OiB7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICB1bml0OiBVbml0O1xuICB9O1xuICBkb3dubG9hZE1pbmltdW0/OiB7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICB1bml0OiBVbml0O1xuICB9O1xuICB1cGxvYWRNaW5pbXVtPzoge1xuICAgIHZhbHVlOiBudW1iZXI7XG4gICAgdW5pdDogVW5pdDtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZmluZEVsdHJhZmljb1RjKCkge1xuICByZXR1cm4gRGVuby5lbnYuZ2V0KFwiVENcIikgfHwgXCJlbHRyYWZpY28tdGNcIjtcbn1cblxuZXhwb3J0IGNsYXNzIEVsVHJhZmljbyB7XG4gICN0YzogRGVuby5DaGlsZFByb2Nlc3M7XG4gICNyZWFkZXI7XG4gICN3cml0ZXI7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuI3RjID0gbmV3IERlbm8uQ29tbWFuZChcInBrZXhlY1wiLCB7XG4gICAgICBhcmdzOiBbZmluZEVsdHJhZmljb1RjKCldLFxuICAgICAgc3Rkb3V0OiBcInBpcGVkXCIsXG4gICAgICBzdGRpbjogXCJwaXBlZFwiLFxuICAgICAgc3RkZXJyOiBcImluaGVyaXRcIixcbiAgICB9KS5zcGF3bigpO1xuICAgIHRoaXMuI3JlYWRlciA9IHRoaXMuI3RjLnN0ZG91dC5nZXRSZWFkZXIoKTtcbiAgICB0aGlzLiN3cml0ZXIgPSB0aGlzLiN0Yy5zdGRpbi5nZXRXcml0ZXIoKTtcbiAgfVxuICBhc3luYyAjcmVhZCgpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy4jcmVhZGVyLnJlYWQoKS50aGVuKChkYXRhKSA9PlxuICAgICAgLy8gdGhlIGRhdGEgaXMgc21hbGxcbiAgICAgIC8vIGl0IHNob3VsZCBiZSBkb25lIGluIG9uZSByZWFkXG4gICAgICAvLyBOT1RFOiB0aGlzIGFzc3VtcHRpb24gbWlnaHQgbm90IGhvbGRcbiAgICAgIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShkYXRhLnZhbHVlKVxuICAgICk7XG4gIH1cbiAgYXN5bmMgI3dyaXRlKGRhdGE6IHN0cmluZykge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLiN3cml0ZXIud3JpdGUoXG4gICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZGF0YSArIFwiXFxuXCIpLFxuICAgICk7XG4gIH1cbiAgYXN5bmMgbGltaXQocHJvZ3JhbTogUHJvZ3JhbSkge1xuICAgIGNvbnN0IHN0YXJ0TXNnID0gcHJvZ3JhbS5nbG9iYWwgPyBcIkdsb2JhbDogXCIgOiBgUHJvZ3JhbTogJHtwcm9ncmFtLm5hbWV9YDtcbiAgICBjb25zdCBsaW1pdEFjdGlvbiA9IGAke3N0YXJ0TXNnfSAke2dldExpbWl0KHByb2dyYW0uZG93bmxvYWRMaW1pdCl9ICR7XG4gICAgICBnZXRMaW1pdChwcm9ncmFtLnVwbG9hZExpbWl0KVxuICAgIH0gJHtnZXRMaW1pdChwcm9ncmFtLmRvd25sb2FkTWluaW11bSl9ICR7Z2V0TGltaXQocHJvZ3JhbS51cGxvYWRNaW5pbXVtKX1gO1xuXG4gICAgYXdhaXQgdGhpcy4jd3JpdGUobGltaXRBY3Rpb24pO1xuICB9XG4gIGFzeW5jIHN0b3AoKSB7XG4gICAgYXdhaXQgdGhpcy4jd3JpdGUoXCJTdG9wXCIpO1xuICB9XG4gIGFzeW5jIGludGVyZmFjZShuYW1lOiBzdHJpbmcpIHtcbiAgICBhd2FpdCB0aGlzLiN3cml0ZShgSW50ZXJmYWNlOiAke25hbWV9YCk7XG4gIH1cbiAgYXN5bmMgcG9sbCgpIHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy4jcmVhZCgpO1xuXG4gICAgaWYgKGRhdGEgPT0gXCJTdG9wXCIpIHtcbiAgICAgIHJldHVybiB7IHN0b3A6IHRydWUgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJvZ3JhbXM6IGRhdGEuc3BsaXQoXCJcXG5cIikuZmlsdGVyKChsKSA9PiBsKVxuICAgICAgICAubWFwKChsaW5lKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHsgbmFtZTogbGluZS5zcGxpdChcIlByb2dyYW1FbnRyeTogXCIpWzFdIH07XG4gICAgICAgIH0pLFxuICAgICAgc3RvcDogZmFsc2UsXG4gICAgfTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRMaW1pdChsaW1pdEFuZFVuaXQ/OiB7IHZhbHVlOiBudW1iZXI7IHVuaXQ6IFVuaXQgfSkge1xuICBpZiAobGltaXRBbmRVbml0KSB7XG4gICAgcmV0dXJuIGxpbWl0QW5kVW5pdC52YWx1ZS50b1N0cmluZygpICsgbGltaXRBbmRVbml0LnVuaXQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFwiTm9uZVwiO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBdUJBLFNBQVM7RUFDUCxPQUFPLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTO0FBQy9CO0FBRUEsT0FBTyxNQUFNO0VBQ1gsQ0FBQSxFQUFHLENBQW9CO0VBQ3ZCLENBQUEsTUFBTyxDQUFDO0VBQ1IsQ0FBQSxNQUFPLENBQUM7RUFDUixhQUFjO0lBQ1osSUFBSSxDQUFDLENBQUEsRUFBRyxHQUFHLElBQUksS0FBSyxPQUFPLENBQUMsVUFBVTtNQUNwQyxNQUFNO1FBQUM7T0FBa0I7TUFDekIsUUFBUTtNQUNSLE9BQU87TUFDUCxRQUFRO0lBQ1YsR0FBRyxLQUFLO0lBQ1IsSUFBSSxDQUFDLENBQUEsTUFBTyxHQUFHLElBQUksQ0FBQyxDQUFBLEVBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUztJQUN4QyxJQUFJLENBQUMsQ0FBQSxNQUFPLEdBQUcsSUFBSSxDQUFDLENBQUEsRUFBRyxDQUFDLEtBQUssQ0FBQyxTQUFTO0VBQ3pDO0VBQ0EsTUFBTSxDQUFBLElBQUs7SUFDVCxPQUFPLE1BQU0sSUFBSSxDQUFDLENBQUEsTUFBTyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxPQUNyQyxvQkFBb0I7TUFDcEIsZ0NBQWdDO01BQ2hDLHVDQUF1QztNQUN2QyxJQUFJLGNBQWMsTUFBTSxDQUFDLEtBQUssS0FBSztFQUV2QztFQUNBLE1BQU0sQ0FBQSxLQUFNLENBQUMsSUFBWTtJQUN2QixPQUFPLE1BQU0sSUFBSSxDQUFDLENBQUEsTUFBTyxDQUFDLEtBQUssQ0FDN0IsSUFBSSxjQUFjLE1BQU0sQ0FBQyxPQUFPO0VBRXBDO0VBQ0EsTUFBTSxNQUFNLE9BQWdCLEVBQUU7SUFDNUIsTUFBTSxXQUFXLFFBQVEsTUFBTSxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsUUFBUSxJQUFJLEVBQUU7SUFDekUsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLEVBQUUsU0FBUyxRQUFRLGFBQWEsRUFBRSxDQUFDLEVBQ2xFLFNBQVMsUUFBUSxXQUFXLEVBQzdCLENBQUMsRUFBRSxTQUFTLFFBQVEsZUFBZSxFQUFFLENBQUMsRUFBRSxTQUFTLFFBQVEsYUFBYSxHQUFHO0lBRTFFLE1BQU0sSUFBSSxDQUFDLENBQUEsS0FBTSxDQUFDO0VBQ3BCO0VBQ0EsTUFBTSxPQUFPO0lBQ1gsTUFBTSxJQUFJLENBQUMsQ0FBQSxLQUFNLENBQUM7RUFDcEI7RUFDQSxNQUFNLFVBQVUsSUFBWSxFQUFFO0lBQzVCLE1BQU0sSUFBSSxDQUFDLENBQUEsS0FBTSxDQUFDLENBQUMsV0FBVyxFQUFFLE1BQU07RUFDeEM7RUFDQSxNQUFNLE9BQU87SUFDWCxNQUFNLE9BQU8sTUFBTSxJQUFJLENBQUMsQ0FBQSxJQUFLO0lBRTdCLElBQUksUUFBUSxRQUFRO01BQ2xCLE9BQU87UUFBRSxNQUFNO01BQUs7SUFDdEI7SUFFQSxPQUFPO01BQ0wsVUFBVSxLQUFLLEtBQUssQ0FBQyxNQUFNLE1BQU0sQ0FBQyxDQUFDLElBQU0sR0FDdEMsR0FBRyxDQUFDLENBQUM7UUFDSixPQUFPO1VBQUUsTUFBTSxLQUFLLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO1FBQUM7TUFDakQ7TUFDRixNQUFNO0lBQ1I7RUFDRjtBQUNGO0FBRUEsU0FBUyxTQUFTLFlBQTRDO0VBQzVELElBQUksY0FBYztJQUNoQixPQUFPLGFBQWEsS0FBSyxDQUFDLFFBQVEsS0FBSyxhQUFhLElBQUk7RUFDMUQsT0FBTztJQUNMLE9BQU87RUFDVDtBQUNGIn0=
// denoCacheMetadata=17187146366296421138,1074501964138475195