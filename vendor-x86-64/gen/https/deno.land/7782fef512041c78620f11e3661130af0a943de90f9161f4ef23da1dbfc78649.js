// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.
/** Supporting functions for media_types that do not make part of the public
 * API.
 *
 * @module
 * @private
 */ /** A map of extensions for a given media type. */ export const extensions = new Map();
export function consumeToken(v) {
  const notPos = indexOf(v, isNotTokenChar);
  if (notPos === -1) {
    return [
      v,
      ""
    ];
  }
  if (notPos === 0) {
    return [
      "",
      v
    ];
  }
  return [
    v.slice(0, notPos),
    v.slice(notPos)
  ];
}
export function consumeValue(v) {
  if (!v) {
    return [
      "",
      v
    ];
  }
  if (v[0] !== `"`) {
    return consumeToken(v);
  }
  let value = "";
  for(let i = 1; i < v.length; i++){
    const r = v[i];
    if (r === `"`) {
      return [
        value,
        v.slice(i + 1)
      ];
    }
    const next = v[i + 1];
    if (r === "\\" && typeof next === "string" && isTSpecial(next)) {
      value += next;
      i++;
      continue;
    }
    if (r === "\r" || r === "\n") {
      return [
        "",
        v
      ];
    }
    value += v[i];
  }
  return [
    "",
    v
  ];
}
export function consumeMediaParam(v) {
  let rest = v.trimStart();
  if (!rest.startsWith(";")) {
    return [
      "",
      "",
      v
    ];
  }
  rest = rest.slice(1);
  rest = rest.trimStart();
  let param;
  [param, rest] = consumeToken(rest);
  param = param.toLowerCase();
  if (!param) {
    return [
      "",
      "",
      v
    ];
  }
  rest = rest.slice(1);
  rest = rest.trimStart();
  const [value, rest2] = consumeValue(rest);
  if (value === "" && rest2 === rest) {
    return [
      "",
      "",
      v
    ];
  }
  rest = rest2;
  return [
    param,
    value,
    rest
  ];
}
export function decode2331Encoding(v) {
  const sv = v.split(`'`, 3);
  if (sv.length !== 3) {
    return undefined;
  }
  const [sv0, , sv2] = sv;
  const charset = sv0.toLowerCase();
  if (!charset) {
    return undefined;
  }
  if (charset !== "us-ascii" && charset !== "utf-8") {
    return undefined;
  }
  const encv = decodeURI(sv2);
  if (!encv) {
    return undefined;
  }
  return encv;
}
function indexOf(s, fn) {
  let i = -1;
  for (const v of s){
    i++;
    if (fn(v)) {
      return i;
    }
  }
  return -1;
}
export function isIterator(obj) {
  if (obj === null || obj === undefined) {
    return false;
  }
  // deno-lint-ignore no-explicit-any
  return typeof obj[Symbol.iterator] === "function";
}
export function isToken(s) {
  if (!s) {
    return false;
  }
  return indexOf(s, isNotTokenChar) < 0;
}
function isNotTokenChar(r) {
  return !isTokenChar(r);
}
function isTokenChar(r) {
  const code = r.charCodeAt(0);
  return code > 0x20 && code < 0x7f && !isTSpecial(r);
}
function isTSpecial(r) {
  return r[0] ? `()<>@,;:\\"/[]?=`.includes(r[0]) : false;
}
const CHAR_CODE_SPACE = " ".charCodeAt(0);
const CHAR_CODE_TILDE = "~".charCodeAt(0);
export function needsEncoding(s) {
  for (const b of s){
    const charCode = b.charCodeAt(0);
    if ((charCode < CHAR_CODE_SPACE || charCode > CHAR_CODE_TILDE) && b !== "\t") {
      return true;
    }
  }
  return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjIxNi4wL21lZGlhX3R5cGVzL191dGlsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjQgdGhlIERlbm8gYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5cbi8qKiBTdXBwb3J0aW5nIGZ1bmN0aW9ucyBmb3IgbWVkaWFfdHlwZXMgdGhhdCBkbyBub3QgbWFrZSBwYXJ0IG9mIHRoZSBwdWJsaWNcbiAqIEFQSS5cbiAqXG4gKiBAbW9kdWxlXG4gKiBAcHJpdmF0ZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIERCRW50cnkge1xuICBzb3VyY2U6IHN0cmluZztcbiAgY29tcHJlc3NpYmxlPzogYm9vbGVhbjtcbiAgY2hhcnNldD86IHN0cmluZztcbiAgZXh0ZW5zaW9ucz86IHN0cmluZ1tdO1xufVxuXG4vKiogQSBtYXAgb2YgZXh0ZW5zaW9ucyBmb3IgYSBnaXZlbiBtZWRpYSB0eXBlLiAqL1xuZXhwb3J0IGNvbnN0IGV4dGVuc2lvbnM6IE1hcDxzdHJpbmcsIHN0cmluZ1tdPiA9IG5ldyBNYXAoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnN1bWVUb2tlbih2OiBzdHJpbmcpOiBbdG9rZW46IHN0cmluZywgcmVzdDogc3RyaW5nXSB7XG4gIGNvbnN0IG5vdFBvcyA9IGluZGV4T2YodiwgaXNOb3RUb2tlbkNoYXIpO1xuICBpZiAobm90UG9zID09PSAtMSkge1xuICAgIHJldHVybiBbdiwgXCJcIl07XG4gIH1cbiAgaWYgKG5vdFBvcyA9PT0gMCkge1xuICAgIHJldHVybiBbXCJcIiwgdl07XG4gIH1cbiAgcmV0dXJuIFt2LnNsaWNlKDAsIG5vdFBvcyksIHYuc2xpY2Uobm90UG9zKV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25zdW1lVmFsdWUodjogc3RyaW5nKTogW3ZhbHVlOiBzdHJpbmcsIHJlc3Q6IHN0cmluZ10ge1xuICBpZiAoIXYpIHtcbiAgICByZXR1cm4gW1wiXCIsIHZdO1xuICB9XG4gIGlmICh2WzBdICE9PSBgXCJgKSB7XG4gICAgcmV0dXJuIGNvbnN1bWVUb2tlbih2KTtcbiAgfVxuICBsZXQgdmFsdWUgPSBcIlwiO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IHYubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCByID0gdltpXTtcbiAgICBpZiAociA9PT0gYFwiYCkge1xuICAgICAgcmV0dXJuIFt2YWx1ZSwgdi5zbGljZShpICsgMSldO1xuICAgIH1cbiAgICBjb25zdCBuZXh0ID0gdltpICsgMV07XG4gICAgaWYgKHIgPT09IFwiXFxcXFwiICYmIHR5cGVvZiBuZXh0ID09PSBcInN0cmluZ1wiICYmIGlzVFNwZWNpYWwobmV4dCkpIHtcbiAgICAgIHZhbHVlICs9IG5leHQ7XG4gICAgICBpKys7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKHIgPT09IFwiXFxyXCIgfHwgciA9PT0gXCJcXG5cIikge1xuICAgICAgcmV0dXJuIFtcIlwiLCB2XTtcbiAgICB9XG4gICAgdmFsdWUgKz0gdltpXTtcbiAgfVxuICByZXR1cm4gW1wiXCIsIHZdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uc3VtZU1lZGlhUGFyYW0oXG4gIHY6IHN0cmluZyxcbik6IFtrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgcmVzdDogc3RyaW5nXSB7XG4gIGxldCByZXN0ID0gdi50cmltU3RhcnQoKTtcbiAgaWYgKCFyZXN0LnN0YXJ0c1dpdGgoXCI7XCIpKSB7XG4gICAgcmV0dXJuIFtcIlwiLCBcIlwiLCB2XTtcbiAgfVxuICByZXN0ID0gcmVzdC5zbGljZSgxKTtcbiAgcmVzdCA9IHJlc3QudHJpbVN0YXJ0KCk7XG4gIGxldCBwYXJhbTogc3RyaW5nO1xuICBbcGFyYW0sIHJlc3RdID0gY29uc3VtZVRva2VuKHJlc3QpO1xuICBwYXJhbSA9IHBhcmFtLnRvTG93ZXJDYXNlKCk7XG4gIGlmICghcGFyYW0pIHtcbiAgICByZXR1cm4gW1wiXCIsIFwiXCIsIHZdO1xuICB9XG4gIHJlc3QgPSByZXN0LnNsaWNlKDEpO1xuICByZXN0ID0gcmVzdC50cmltU3RhcnQoKTtcbiAgY29uc3QgW3ZhbHVlLCByZXN0Ml0gPSBjb25zdW1lVmFsdWUocmVzdCk7XG4gIGlmICh2YWx1ZSA9PT0gXCJcIiAmJiByZXN0MiA9PT0gcmVzdCkge1xuICAgIHJldHVybiBbXCJcIiwgXCJcIiwgdl07XG4gIH1cbiAgcmVzdCA9IHJlc3QyO1xuICByZXR1cm4gW3BhcmFtLCB2YWx1ZSwgcmVzdF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGUyMzMxRW5jb2Rpbmcodjogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgY29uc3Qgc3YgPSB2LnNwbGl0KGAnYCwgMyk7XG4gIGlmIChzdi5sZW5ndGggIT09IDMpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGNvbnN0IFtzdjAsICwgc3YyXSA9IHN2IGFzIFtzdHJpbmcsIHN0cmluZywgc3RyaW5nXTtcbiAgY29uc3QgY2hhcnNldCA9IHN2MC50b0xvd2VyQ2FzZSgpO1xuICBpZiAoIWNoYXJzZXQpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGlmIChjaGFyc2V0ICE9PSBcInVzLWFzY2lpXCIgJiYgY2hhcnNldCAhPT0gXCJ1dGYtOFwiKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBjb25zdCBlbmN2ID0gZGVjb2RlVVJJKHN2Mik7XG4gIGlmICghZW5jdikge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgcmV0dXJuIGVuY3Y7XG59XG5cbmZ1bmN0aW9uIGluZGV4T2Y8VD4oczogSXRlcmFibGU8VD4sIGZuOiAoczogVCkgPT4gYm9vbGVhbik6IG51bWJlciB7XG4gIGxldCBpID0gLTE7XG4gIGZvciAoY29uc3QgdiBvZiBzKSB7XG4gICAgaSsrO1xuICAgIGlmIChmbih2KSkge1xuICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICB9XG4gIHJldHVybiAtMTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzSXRlcmF0b3I8VD4ob2JqOiB1bmtub3duKTogb2JqIGlzIEl0ZXJhYmxlPFQ+IHtcbiAgaWYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuICByZXR1cm4gdHlwZW9mIChvYmogYXMgYW55KVtTeW1ib2wuaXRlcmF0b3JdID09PSBcImZ1bmN0aW9uXCI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1Rva2VuKHM6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBpZiAoIXMpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIGluZGV4T2YocywgaXNOb3RUb2tlbkNoYXIpIDwgMDtcbn1cblxuZnVuY3Rpb24gaXNOb3RUb2tlbkNoYXIocjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAhaXNUb2tlbkNoYXIocik7XG59XG5cbmZ1bmN0aW9uIGlzVG9rZW5DaGFyKHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBjb2RlID0gci5jaGFyQ29kZUF0KDApO1xuICByZXR1cm4gY29kZSA+IDB4MjAgJiYgY29kZSA8IDB4N2YgJiYgIWlzVFNwZWNpYWwocik7XG59XG5cbmZ1bmN0aW9uIGlzVFNwZWNpYWwocjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiByWzBdID8gYCgpPD5ALDs6XFxcXFwiL1tdPz1gLmluY2x1ZGVzKHJbMF0pIDogZmFsc2U7XG59XG5cbmNvbnN0IENIQVJfQ09ERV9TUEFDRSA9IFwiIFwiLmNoYXJDb2RlQXQoMCk7XG5jb25zdCBDSEFSX0NPREVfVElMREUgPSBcIn5cIi5jaGFyQ29kZUF0KDApO1xuXG5leHBvcnQgZnVuY3Rpb24gbmVlZHNFbmNvZGluZyhzOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgZm9yIChjb25zdCBiIG9mIHMpIHtcbiAgICBjb25zdCBjaGFyQ29kZSA9IGIuY2hhckNvZGVBdCgwKTtcbiAgICBpZiAoXG4gICAgICAoY2hhckNvZGUgPCBDSEFSX0NPREVfU1BBQ0UgfHwgY2hhckNvZGUgPiBDSEFSX0NPREVfVElMREUpICYmIGIgIT09IFwiXFx0XCJcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMEVBQTBFO0FBRTFFOzs7OztDQUtDLEdBUUQsZ0RBQWdELEdBQ2hELE9BQU8sTUFBTSxhQUFvQyxJQUFJLE1BQU07QUFFM0QsT0FBTyxTQUFTLGFBQWEsQ0FBUztFQUNwQyxNQUFNLFNBQVMsUUFBUSxHQUFHO0VBQzFCLElBQUksV0FBVyxDQUFDLEdBQUc7SUFDakIsT0FBTztNQUFDO01BQUc7S0FBRztFQUNoQjtFQUNBLElBQUksV0FBVyxHQUFHO0lBQ2hCLE9BQU87TUFBQztNQUFJO0tBQUU7RUFDaEI7RUFDQSxPQUFPO0lBQUMsRUFBRSxLQUFLLENBQUMsR0FBRztJQUFTLEVBQUUsS0FBSyxDQUFDO0dBQVE7QUFDOUM7QUFFQSxPQUFPLFNBQVMsYUFBYSxDQUFTO0VBQ3BDLElBQUksQ0FBQyxHQUFHO0lBQ04sT0FBTztNQUFDO01BQUk7S0FBRTtFQUNoQjtFQUNBLElBQUksQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQ2hCLE9BQU8sYUFBYTtFQUN0QjtFQUNBLElBQUksUUFBUTtFQUNaLElBQUssSUFBSSxJQUFJLEdBQUcsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFLO0lBQ2pDLE1BQU0sSUFBSSxDQUFDLENBQUMsRUFBRTtJQUNkLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO01BQ2IsT0FBTztRQUFDO1FBQU8sRUFBRSxLQUFLLENBQUMsSUFBSTtPQUFHO0lBQ2hDO0lBQ0EsTUFBTSxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUU7SUFDckIsSUFBSSxNQUFNLFFBQVEsT0FBTyxT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
// denoCacheMetadata=18416730114543723491,9144516338669331219